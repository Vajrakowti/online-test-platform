<!DOCTYPE html>
<html>
<head>
  <title>Create Quiz</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary-color: #4e73df;
      --secondary-color: #f8f9fc;
      --accent-color: #36b9cc;
      --success-color: #1cc88a;
      --danger-color: #e74a3b;
      --warning-color: #f6c23e;
      --text-color: #5a5c69;
      --border-color: #e3e6f0;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }
    
    body {
      background-color: var(--secondary-color);
      min-height: 100vh;
    }
    
    .admin-container {
      display: flex;
      min-height: 100vh;
    }
    
    /* Sidebar Styles */
    .sidebar {
      width: 260px;
      min-height: 100vh;
      background-color: #4361ee;
      color: white;
      padding: 20px 0;
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      z-index: 100;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      padding: 0 20px;
      margin-bottom: 20px;
    }

    .sidebar-header i {
      font-size: 2.5rem;
      margin-right: 12px;
    }

    .sidebar-title {
      display: flex;
      flex-direction: column;
    }

    .sidebar-title h1 {
      font-size: 1.3rem;
      font-weight: 600;
      line-height: 1.2;
    }

    .sidebar-divider {
      height: 1px;
      background-color: rgba(255, 255, 255, 0.2);
      margin: 15px 0;
    }

    .sidebar-menu {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .sidebar-item {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: white;
      text-decoration: none;
      transition: all 0.3s;
      border-radius: 0;
      font-weight: 500;
      font-size: 1.05rem;
    }

    .sidebar-item.active,
    .sidebar-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 0;
    }

    .sidebar-item i {
      font-size: 1.25rem;
      margin-right: 12px;
      width: 24px;
      text-align: center;
    }
    
    /* Signout Button */
    .signout-container {
      margin-top: auto;
      padding: 24px 20px 20px 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    
    .logout-btn {
      width: 100%;
      background-color: #e74a3b;
      color: white;
      border: none;
      padding: 14px 0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: background 0.2s, box-shadow 0.2s;
    }
    
    .logout-btn:hover {
      background-color: #c0392b;
      box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    }
    
    /* Dropdown styles */
    .sidebar-dropdown {
      position: relative;
    }
    
    .dropdown-toggle {
      justify-content: space-between;
      cursor: pointer;
    }
    
    .dropdown-icon {
      margin-left: auto;
      margin-right: 0;
      transition: transform 0.3s;
      font-size: 0.8rem;
    }
    
    .dropdown-toggle.active .dropdown-icon {
      transform: rotate(180deg);
    }
    
    .dropdown-menu {
      display: none;
      background-color: rgba(0, 0, 0, 0.1);
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    
    .dropdown-menu.show {
      display: block;
    }
    
    .dropdown-item {
      display: block;
      padding: 10px 20px 10px 56px;
      color: white;
      text-decoration: none;
      transition: background-color 0.3s;
      font-size: 1rem;
    }
    
    .dropdown-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .main-content {
      flex: 1;
      margin-left: 260px;
      padding: 40px 20px;
    }
    
    .form-container {
      background-color: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      transition: transform 0.3s ease;
    }
    
    .form-container:hover {
      transform: translateY(-5px);
    }
    
    h2 {
      color: var(--primary-color);
      text-align: center;
      margin-bottom: 30px;
      font-size: 1.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    h2 i {
      margin-right: 15px;
    }
    
    .form-group {
      margin-bottom: 25px;
      position: relative;
    }
    
    label {
      font-weight: 600;
      display: block;
      margin-bottom: 10px;
      color: var(--text-color);
      font-size: 0.9rem;
    }
    
    .required:after {
      content: " *";
      color: var(--danger-color);
    }
    
    input, select, textarea {
      padding: 14px 15px;
      margin: 5px 0;
      font-size: 15px;
      width: 100%;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      box-sizing: border-box;
      transition: all 0.3s ease;
      background-color: white;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
    }
    
    input[type="file"] {
      padding: 11px;
    }
    
    .btn {
      padding: 14px 25px;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      width: 100%;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 10px;
    }
    
    .btn i {
      margin-right: 10px;
    }
    
    .btn-submit {
      background-color: var(--success-color);
    }
    
    .btn-submit:hover {
      background-color: #17a673;
      transform: translateY(-2px);
    }
    
    .btn-back {
      background-color: var(--accent-color);
      margin-top: 20px;
    }
    
    .btn-back:hover {
      background-color: #2c9faf;
      transform: translateY(-2px);
    }

    .quiz-type-selector {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      justify-content: center;
    }

    .quiz-type-btn {
      padding: 15px 25px;
      border: 2px solid var(--primary-color);
      background: white;
      color: var(--primary-color);
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .quiz-type-btn.active {
      background: var(--primary-color);
      color: white;
    }

    .quiz-section {
      display: none;
    }

    .quiz-section.active {
      display: block;
    }

    .question-container {
      border: 1px solid var(--border-color);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .question-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .remove-question {
      background: var(--danger-color);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    .image-preview {
      max-width: 200px;
      max-height: 200px;
      margin: 10px 0;
      display: none;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .main-content {
        margin-left: 70px;
    }
    
      .sidebar {
        width: 70px;
        padding: 15px 0;
      }
      
      .sidebar-header {
        padding: 0 15px;
        justify-content: center;
      }
      
      .sidebar-title,
      .sidebar-item span,
      .dropdown-icon {
      display: none;
    }

      .sidebar-header i {
        margin-right: 0;
    }

      .sidebar-item {
        justify-content: center;
        padding: 12px;
    }

      .sidebar-item i {
        margin-right: 0;
    }

      .dropdown-item {
        padding: 12px;
      text-align: center;
    }

      .form-container {
        padding: 25px;
    }

      .quiz-type-selector {
      flex-direction: column;
    }
    }

    /* Modern Math Symbols Panel Styles */
    .math-keyboard {
      display: none;
      position: fixed;
      bottom: 90px;
      right: 30px;
      width: 400px;
      max-width: 90vw;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      z-index: 1000;
      animation: slideUp 0.3s ease-out;
      overflow: hidden;
    }
    
    @keyframes slideUp {
      from {transform: translateY(30px); opacity: 0;}
      to {transform: translateY(0); opacity: 1;}
    }
    
    .math-keyboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background-color: #4e73df;
      color: white;
    }
    
    .math-keyboard-header h4 {
      margin: 0;
      font-size: 18px;
    }
    
    .math-keyboard-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .math-keyboard-close:hover {
      transform: scale(1.2);
    }
    
    .math-keyboard-categories {
      display: flex;
      flex-wrap: wrap;
      padding: 10px;
      background-color: #f8f9fc;
      overflow-x: auto;
      scrollbar-width: thin;
      border-bottom: 1px solid #e3e6f0;
    }
    
    .math-keyboard-category {
      padding: 8px 12px;
      margin: 5px;
      border: none;
      border-radius: 20px;
      background-color: #eef1ff;
      color: #4e73df;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
      font-weight: 600;
    }
    
    .math-keyboard-category:hover {
      background-color: #4e73df;
      color: white;
    }
    
    .math-keyboard-category.active {
      background-color: #4e73df;
      color: white;
      box-shadow: 0 3px 5px rgba(78, 115, 223, 0.3);
    }
    
    .math-keyboard-symbols {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .math-keyboard-symbol {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 50px;
      border: 1px solid #e3e6f0;
      border-radius: 8px;
      background-color: white;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .math-keyboard-symbol:hover {
      background-color: #4e73df;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .math-keyboard-toggle {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: #4e73df;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      z-index: 999;
      transition: all 0.3s;
    }
    
    .math-keyboard-toggle:hover {
      transform: scale(1.1);
      background-color: #3756a4;
    }
    
    .math-keyboard-toggle i {
      font-size: 24px;
    }

    .math-keyboard-toggle.active {
      background-color: #e74a3b;
      transform: rotate(45deg);
    }
    
    /* Add math symbol buttons to question fields */
    .insert-symbol-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #4e73df;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      transition: all 0.2s;
    }
    
    .insert-symbol-btn:hover {
      background-color: #eef1ff;
    }

    /* Add styles for sections */
    .section-item {
      margin-bottom: 15px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .section-header {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .section-header input[type="text"] {
      flex-grow: 1;
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      background-color: #fff;
      color: #333;
      display: block !important;
      height: 38px !important;
      min-width: 150px;
      opacity: 1 !important;
      pointer-events: auto !important;
    }
    
    .remove-section-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .remove-section-btn:hover {
      background: #c82333;
    }

    .section-item .section-header input[type="text"] {
      flex-grow: 1;
      /* Temporarily set a fixed width to force visibility if flexbox is the issue */
      width: 200px; /* Explicit width for debugging */
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      background-color: #fff; /* Revert to white */
      color: #333;
      display: block !important;
      height: 38px !important;
      min-width: 150px;
      opacity: 1 !important;
      pointer-events: auto !important;
    }

    .form-group input[type="time"] {
      width: 200px;
    }

    .negative-marking-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .negative-marking-container input[type="number"] {
      width: 100px;
    }

    .negative-marking-info {
      font-size: 0.85rem;
      color: var(--text-color);
      margin-top: 5px;
    }

    .question-marks-container {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .question-marks-info {
      font-size: 0.85rem;
      color: var(--text-color);
      margin-top: 5px;
    }

    .form-group input[type="file"] {
      padding: 11px;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <i class="fas fa-graduation-cap"></i>
        <div class="sidebar-title">
          <h1>Test</h1>
          <h1>Platform</h1>
        </div>
      </div>
      <div class="sidebar-divider"></div>
      <nav class="sidebar-menu">
        <a href="/admin" class="sidebar-item">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </a>
        <div class="sidebar-dropdown">
          <a href="javascript:void(0)" class="sidebar-item dropdown-toggle">
            <i class="fas fa-users"></i>
            <span>Students</span>
            <i class="fas fa-chevron-down dropdown-icon"></i>
          </a>
          <div class="dropdown-menu">
            <a href="/admin/add-student" class="dropdown-item">Add Students</a>
            <a href="/admin/students" class="dropdown-item">View Students</a>
          </div>
        </div>
        <div class="sidebar-dropdown">
          <a href="javascript:void(0)" class="sidebar-item dropdown-toggle">
            <i class="fas fa-clipboard-list"></i>
            <span>Quizzes</span>
            <i class="fas fa-chevron-down dropdown-icon"></i>
          </a>
          <div class="dropdown-menu">
            <a href="/admin/create-quiz" class="dropdown-item">Create Quiz</a>
            <a href="/admin/total-quiz" class="dropdown-item">View Quizzes</a>
          </div>
        </div>
        <a href="/admin/retake-quiz" class="sidebar-item">
          <i class="fas fa-user-check"></i>
          <span>Student-Specific Quiz</span>
        </a>
        <a href="/admin/messages" class="sidebar-item">
          <i class="fas fa-envelope"></i>
          <span>Student Messages</span>
        </a>
      </nav>
      <div class="signout-container">
        <button onclick="window.location.href='/admin/logout'" class="logout-btn">
          <i class="fas fa-sign-out-alt"></i>
          Logout
        </button>
      </div>
    </aside>
    
    <main class="main-content">
      <div class="form-container">
        <h2><i class="fas fa-clipboard-list"></i> Create New Quiz</h2>
    
    <div class="quiz-type-selector">
      <button type="button" class="quiz-type-btn active" data-type="excel">Excel Upload</button>
      <button type="button" class="quiz-type-btn" data-type="manual">Manual Entry</button>
    </div>

    <form id="excelQuizForm" class="quiz-section active" action="/admin/create-quiz" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="quizType" value="excel">
      <div class="form-group">
        <label class="required">Quiz Name:</label>
        <input type="text" name="quizName" id="quizName" required>
      </div>
      
      <div class="form-group">
        <label class="required">Class:</label>
        <select name="quizClass" id="quizClass" required>
          <option value="">Select Class</option>
          <option value="1">Class 1</option>
          <option value="2">Class 2</option>
          <option value="3">Class 3</option>
          <option value="4">Class 4</option>
          <option value="5">Class 5</option>
          <option value="6">Class 6</option>
          <option value="7">Class 7</option>
          <option value="8">Class 8</option>
          <option value="9">Class 9</option>
          <option value="10">Class 10</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="required">Exam Date:</label>
        <input type="date" name="examDate" id="examDate" required>
      </div>
      
      <div class="form-group">
        <label class="required">Test Duration (minutes):</label>
        <input type="number" name="testDuration" id="testDuration" min="1" value="60" required>
        <span class="question-marks-info">(Enter duration in minutes, e.g. 120 for 2 hours)</span>
      </div>
      
      <div class="form-group">
        <label class="required">Test Available From:</label>
        <input type="time" name="startTime" id="startTime" required>
      </div>
      
      <div class="form-group">
        <label class="required">Test Available Until:</label>
        <input type="time" name="endTime" id="endTime" required>
      </div>
      
      <div class="form-group">
        <label class="required">Negative Marking:</label>
        <div class="negative-marking-container">
          <input type="number" name="negativeMarking" id="negativeMarking" min="0" max="1" step="0.25" value="0" required>
          <span class="negative-marking-info">(Enter value between 0 and 1, e.g. 0.25 for 1/4 negative marking)</span>
        </div>
      </div>
      
      <div class="form-group">
        <label class="required">Question Marks:</label>
        <div class="question-marks-container">
          <input type="number" name="questionMarks" id="questionMarks" min="1" value="1" required>
          <span class="question-marks-info">(Enter marks for each question, default is 1)</span>
        </div>
      </div>
      
      <div class="form-group">
        <label>Quiz Sections:</label>
        <div id="sectionsContainer">
          <div class="section-item">
            <div class="section-header">
              <input type="text" name="sectionNames[]" placeholder="Section Name" required>
              <input type="file" name="sectionFiles[]" accept=".xlsx,.xls" required>
              <button type="button" class="remove-section-btn" onclick="removeSection(this)">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        </div>
        <button type="button" class="btn btn-submit" onclick="addSection()">
          <i class="fas fa-plus"></i> Add Section
        </button>
      </div>
      
      <button type="submit" class="btn btn-submit">
        <i class="fas fa-check-circle"></i> Create Quiz
      </button>
    </form>

    <form id="manualQuizForm" class="quiz-section" action="/admin/create-quiz-manual" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="quizType" value="manual">
      <div class="form-group">
        <label class="required">Quiz Name:</label>
        <input type="text" name="quizName" placeholder="Enter quiz name" required>
      </div>
      
      <div class="form-group">
        <label class="required">Class:</label>
        <select name="quizClass" required>
          <option value="">Select Class</option>
          <option value="1">Class 1</option>
          <option value="2">Class 2</option>
          <option value="3">Class 3</option>
          <option value="4">Class 4</option>
          <option value="5">Class 5</option>
          <option value="6">Class 6</option>
          <option value="7">Class 7</option>
          <option value="8">Class 8</option>
          <option value="9">Class 9</option>
          <option value="10">Class 10</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="required">Exam Date:</label>
        <input type="date" name="examDate" required>
      </div>
      
      <div class="form-group">
        <label class="required">Test Duration (minutes):</label>
        <input type="number" name="testDuration" min="1" value="60" required>
        <span class="question-marks-info">(Enter duration in minutes, e.g. 120 for 2 hours)</span>
      </div>
      
      <div class="form-group">
        <label class="required">Test Available From:</label>
        <input type="time" name="startTime" required>
      </div>
      
      <div class="form-group">
        <label class="required">Test Available Until:</label>
        <input type="time" name="endTime" required>
      </div>

      <div class="form-group">
        <label class="required">Negative Marking:</label>
        <div class="negative-marking-container">
          <input type="number" name="negativeMarking" min="0" max="1" step="0.25" value="0" required>
          <span class="negative-marking-info">(Enter value between 0 and 1, e.g. 0.25 for 1/4 negative marking)</span>
        </div>
      </div>

      <div class="form-group">
        <label class="required">Question Marks:</label>
        <div class="question-marks-container">
          <input type="number" name="questionMarks" min="1" value="1" required>
          <span class="question-marks-info">(Enter marks for each question, default is 1)</span>
        </div>
      </div>

      <button type="button" class="btn add-question-btn" onclick="addQuestion()">
        <i class="fas fa-plus"></i> Add Question
      </button>

      <div id="questionsList"></div>
      
      <button type="submit" class="btn btn-submit">
        <i class="fas fa-check-circle"></i> Create Quiz
      </button>
    </form>
    
    <button class="btn btn-back" onclick="location.href='/admin'">
      <i class="fas fa-arrow-left"></i> Back to Admin
    </button>
  </div>

  <!-- Math Keyboard -->
  <div class="math-keyboard" id="mathKeyboard">
    <div class="math-keyboard-header">
      <h4>Math Symbols</h4>
      <button class="math-keyboard-close" onclick="toggleMathKeyboard()">&times;</button>
    </div>
    <div class="math-keyboard-categories" id="mathCategories">
      <!-- Categories will be added dynamically -->
    </div>
    <div class="math-keyboard-symbols" id="mathSymbols">
      <!-- Symbols will be added dynamically -->
    </div>
  </div>

  <div class="math-keyboard-toggle" onclick="toggleMathKeyboard()">
    <i class="fas fa-square-root-alt"></i>
      </div>
    </main>
  </div>

  <script>
    // Display selected file name for Excel upload
    document.addEventListener('DOMContentLoaded', function() {
      const quizFile = document.getElementById('quizFile');
      if (quizFile) {
        quizFile.addEventListener('change', function(e) {
          const fileName = e.target.files[0] ? e.target.files[0].name : 'No file chosen';
          const fileNameElement = document.getElementById('fileName');
          if (fileNameElement) {
            fileNameElement.textContent = fileName;
          }
        });
      }

      // Quiz type selector functionality
      document.querySelectorAll('.quiz-type-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          // Update button states
          document.querySelectorAll('.quiz-type-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');

          // Show/hide appropriate form
          const type = this.getAttribute('data-type');
          document.querySelectorAll('.quiz-section').forEach(section => {
            section.classList.remove('active');
          });
          const form = document.getElementById(type + 'QuizForm');
          if (form) {
            form.classList.add('active');
          }
          
          // If switching to manual form and no questions exist, add one
          if (type === 'manual' && document.querySelectorAll('.question-container').length === 0) {
            addQuestion();
          }
        });
      });

      // Initialize math keyboard and load custom classes
      initMathKeyboard();
      loadCustomClasses();
    });

    // Load custom classes from localStorage
    function loadCustomClasses() {
      try {
        const customClasses = JSON.parse(localStorage.getItem('customClasses') || '[]');
        console.log('Loading custom classes:', customClasses); // Debug log
        
        const excelQuizClassSelect = document.getElementById('quizClass');
        const manualQuizClassSelect = document.querySelector('#manualQuizForm select[name="quizClass"]');
        
        console.log('Excel select:', excelQuizClassSelect); // Debug log
        console.log('Manual select:', manualQuizClassSelect); // Debug log
        
        // Helper function to update a select element
        function updateSelect(selectElement) {
          if (!selectElement) {
            console.log('Select element not found'); // Debug log
            return;
          }
          
          // Remove any existing custom classes (except the default ones)
          Array.from(selectElement.options).forEach(option => {
            if (!option.value.match(/^[1-9]|10$/)) {
              selectElement.removeChild(option);
            }
          });
          
          // Add custom classes
          customClasses.forEach(cls => {
            if (!Array.from(selectElement.options).some(opt => opt.value === cls)) {
              const opt = document.createElement('option');
              opt.value = cls;
              opt.text = cls;
              selectElement.appendChild(opt);
            }
          });
          
          console.log('Updated select options:', Array.from(selectElement.options).map(opt => opt.value)); // Debug log
        }
        
        // Update both select elements
        updateSelect(excelQuizClassSelect);
        updateSelect(manualQuizClassSelect);
      } catch (error) {
        console.error('Error loading custom classes:', error);
      }
    }

    // Add event listener for storage changes
    window.addEventListener('storage', function(e) {
      if (e.key === 'customClasses') {
        console.log('Storage changed, reloading custom classes'); // Debug log
        loadCustomClasses();
      }
    });

    // Question counter for unique IDs
    let questionCounter = 0;
    let activeField = null;

    // Math symbols data
    const mathSymbols = {
      'Basic': ['+', '-', '×', '÷', '=', '≠', '≈', '±', '·', '°', '%', '‰', '∞'],
      'Algebra': ['x²', 'x³', 'xⁿ', '√', '∛', '∜', '∑', '∏', '∫', '∂', '∇', '∆', '∝'],
      'Geometry': ['∠', '⊥', '∥', '≅', '∼', '△', '□', '○', 'π', 'τ', '°', '∟', '∡'],
      'Calculus': ['∫', '∬', '∭', '∮', '∯', '∰', '∇', '∞', 'lim', '∂', '∆', 'd', '∂'],
      'Logic': ['∀', '∃', '¬', '∧', '∨', '→', '↔', '∴', '∵', '∈', '∉', '⊆', '⊂'],
      'Sets': ['∅', '∪', '∩', '⊆', '⊂', '⊇', '⊃', '∈', '∉', 'ℕ', 'ℤ', 'ℚ', 'ℝ'],
      'Greek': ['α', 'β', 'γ', 'δ', 'ε', 'ζ', 'η', 'θ', 'λ', 'μ', 'π', 'σ', 'ω'],
      'Arrows': ['→', '←', '↑', '↓', '↔', '⇒', '⇔', '↦', '↗', '↘', '↙', '↖', '⇌'],
      'Relations': ['<', '>', '≤', '≥', '≪', '≫', '≡', '≢', '≃', '≅', '∼', '≈', '∝'],
      'Other': ['ℵ', 'ℏ', 'ℑ', 'ℜ', 'ℂ', 'ℚ', 'ℤ', 'ℕ', 'ℝ', '∴', '∵', '■', '□']
    };

    // Initialize math keyboard
    function initMathKeyboard() {
      const categoriesContainer = document.getElementById('mathCategories');
      const symbolsContainer = document.getElementById('mathSymbols');
      
      // Add category buttons
      Object.keys(mathSymbols).forEach(category => {
        const btn = document.createElement('button');
        btn.className = 'math-keyboard-category';
        btn.textContent = category;
        btn.onclick = () => showMathCategory(category);
        categoriesContainer.appendChild(btn);
      });
      
      // Show first category by default
      if (Object.keys(mathSymbols).length > 0) {
        showMathCategory(Object.keys(mathSymbols)[0]);
        document.querySelector('.math-keyboard-category').classList.add('active');
      }
      
      // Add math symbol buttons to text inputs and textareas
      addSymbolButtonsToInputs();
    }

    // Show symbols for a specific category
    function showMathCategory(category) {
      const symbolsContainer = document.getElementById('mathSymbols');
      symbolsContainer.innerHTML = '';
      
      mathSymbols[category].forEach(symbol => {
        const btn = document.createElement('button');
        btn.className = 'math-keyboard-symbol';
        btn.textContent = symbol;
        btn.onclick = () => insertSymbol(symbol);
        symbolsContainer.appendChild(btn);
      });
      
      // Update active category
      document.querySelectorAll('.math-keyboard-category').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelectorAll('.math-keyboard-category').forEach(btn => {
        if (btn.textContent === category) {
          btn.classList.add('active');
        }
      });
    }

    // Toggle math keyboard visibility
    function toggleMathKeyboard() {
      const keyboard = document.getElementById('mathKeyboard');
      const toggleBtn = document.querySelector('.math-keyboard-toggle');
      
      if (keyboard.style.display === 'none' || !keyboard.style.display) {
        keyboard.style.display = 'block';
        toggleBtn.classList.add('active');
      } else {
        keyboard.style.display = 'none';
        toggleBtn.classList.remove('active');
      }
    }

    // Insert symbol at cursor position in active field
    function insertSymbol(symbol) {
      if (activeField) {
        const startPos = activeField.selectionStart;
        const endPos = activeField.selectionEnd;
        const value = activeField.value;
        
        activeField.value = value.substring(0, startPos) + symbol + value.substring(endPos, value.length);
        
        // Set cursor position after the inserted symbol
        activeField.selectionStart = startPos + symbol.length;
        activeField.selectionEnd = startPos + symbol.length;
        
        activeField.focus();
      }
    }

    // Add symbol buttons to all input fields and textareas
    function addSymbolButtonsToInputs() {
      const inputContainers = document.querySelectorAll('.form-group');
      
      inputContainers.forEach(container => {
        const input = container.querySelector('input[type="text"], textarea');
        if (input) {
          // Create wrapper if not already present
          let wrapper = input.parentElement;
          if (!wrapper.style || wrapper.style.position !== 'relative') {
            wrapper = document.createElement('div');
            wrapper.style.position = 'relative';
            input.parentNode.insertBefore(wrapper, input);
            wrapper.appendChild(input);
          }
          
          // Add the symbol button
          const symbolBtn = document.createElement('button');
          symbolBtn.type = 'button';
          symbolBtn.className = 'insert-symbol-btn';
          symbolBtn.innerHTML = '<i class="fas fa-square-root-alt"></i>';
          symbolBtn.addEventListener('click', function(e) {
            e.preventDefault();
            activeField = input;
            toggleMathKeyboard();
          });
          
          wrapper.appendChild(symbolBtn);
        }
      });
    }

    // Set active field when focusing on input/textarea
    document.addEventListener('focusin', function(e) {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
        activeField = e.target;
      }
    });

    function addQuestion() {
      const questionsList = document.getElementById('questionsList');
      const questionDiv = document.createElement('div');
      questionDiv.className = 'question-container';
      questionDiv.id = 'question-' + questionCounter;

      questionDiv.innerHTML = `
        <div class="question-header">
          <h3>Question ${questionCounter + 1}</h3>
          <button type="button" class="remove-question" onclick="removeQuestion(${questionCounter})" ${questionCounter === 0 ? 'style="display:none;"' : ''}>
            <i class="fas fa-trash"></i>
          </button>
        </div>
        <input type="hidden" name="questionIndex" value="${questionCounter}">
        <div class="form-group">
          <label class="required">Question Text:</label>
          <div style="position: relative;">
            <textarea name="questionText_${questionCounter}" id="questionText_${questionCounter}" rows="3" required></textarea>
            <button type="button" class="insert-symbol-btn" onclick="setActiveFieldAndOpenSymbols('questionText_${questionCounter}')">
              <i class="fas fa-square-root-alt"></i>
            </button>
          </div>
        </div>
        <div class="form-group">
          <label>Question Image:</label>
          <input type="file" name="questionImage_${questionCounter}" accept="image/*" onchange="previewImage(this, 'preview-${questionCounter}')">
          <img id="preview-${questionCounter}" class="image-preview">
        </div>
        <div class="form-group">
          <label class="required">Option 1:</label>
          <div style="position: relative;">
            <input type="text" name="questionOption1_${questionCounter}" id="questionOption1_${questionCounter}" required>
            <button type="button" class="insert-symbol-btn" onclick="setActiveFieldAndOpenSymbols('questionOption1_${questionCounter}')">
              <i class="fas fa-square-root-alt"></i>
            </button>
          </div>
          <div class="option-image-container">
            <div class="option-row">
              <label>Option 1 Image (Optional):</label>
              <input type="file" name="questionOption1Image_${questionCounter}" accept="image/*" onchange="previewImage(this, 'preview-opt1-${questionCounter}')">
              <img id="preview-opt1-${questionCounter}" class="image-preview">
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="required">Option 2:</label>
          <div style="position: relative;">
            <input type="text" name="questionOption2_${questionCounter}" id="questionOption2_${questionCounter}" required>
            <button type="button" class="insert-symbol-btn" onclick="setActiveFieldAndOpenSymbols('questionOption2_${questionCounter}')">
              <i class="fas fa-square-root-alt"></i>
            </button>
          </div>
          <div class="option-image-container">
            <div class="option-row">
              <label>Option 2 Image (Optional):</label>
              <input type="file" name="questionOption2Image_${questionCounter}" accept="image/*" onchange="previewImage(this, 'preview-opt2-${questionCounter}')">
              <img id="preview-opt2-${questionCounter}" class="image-preview">
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="required">Option 3:</label>
          <div style="position: relative;">
            <input type="text" name="questionOption3_${questionCounter}" id="questionOption3_${questionCounter}" required>
            <button type="button" class="insert-symbol-btn" onclick="setActiveFieldAndOpenSymbols('questionOption3_${questionCounter}')">
              <i class="fas fa-square-root-alt"></i>
            </button>
          </div>
          <div class="option-image-container">
            <div class="option-row">
              <label>Option 3 Image (Optional):</label>
              <input type="file" name="questionOption3Image_${questionCounter}" accept="image/*" onchange="previewImage(this, 'preview-opt3-${questionCounter}')">
              <img id="preview-opt3-${questionCounter}" class="image-preview">
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="required">Option 4:</label>
          <div style="position: relative;">
            <input type="text" name="questionOption4_${questionCounter}" id="questionOption4_${questionCounter}" required>
            <button type="button" class="insert-symbol-btn" onclick="setActiveFieldAndOpenSymbols('questionOption4_${questionCounter}')">
              <i class="fas fa-square-root-alt"></i>
            </button>
          </div>
          <div class="option-image-container">
            <div class="option-row">
              <label>Option 4 Image (Optional):</label>
              <input type="file" name="questionOption4Image_${questionCounter}" accept="image/*" onchange="previewImage(this, 'preview-opt4-${questionCounter}')">
              <img id="preview-opt4-${questionCounter}" class="image-preview">
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="required">Correct Answer:</label>
          <select name="questionCorrectAnswer_${questionCounter}" required>
            <option value="">Select Correct Answer</option>
            <option value="0">Option 1</option>
            <option value="1">Option 2</option>
            <option value="2">Option 3</option>
            <option value="3">Option 4</option>
          </select>
        </div>
      `;

      questionsList.appendChild(questionDiv);
      questionCounter++;
    }

    // Set active field and open the math symbols panel
    function setActiveFieldAndOpenSymbols(fieldId) {
      activeField = document.getElementById(fieldId);
      if (activeField) {
        activeField.focus();
        toggleMathKeyboard();
      }
    }

    // Function to preview image
    function previewImage(input, previewId) {
      const preview = document.getElementById(previewId);
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        }
        reader.readAsDataURL(input.files[0]);
      } else {
        preview.style.display = 'none';
      }
    }

    // Function to remove question
    function removeQuestion(index) {
      document.getElementById('question-' + index).remove();
    }

    function addSection() {
      const sectionsContainer = document.getElementById('sectionsContainer');
      const sectionDiv = document.createElement('div');
      sectionDiv.className = 'section-item';
      sectionDiv.innerHTML = `
        <div class="section-header">
          <input type="text" name="sectionNames[]" placeholder="Section Name" required>
          <input type="file" name="sectionFiles[]" accept=".xlsx,.xls" required>
          <button type="button" class="remove-section-btn" onclick="removeSection(this)">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      sectionsContainer.appendChild(sectionDiv);
    }

    function removeSection(button) {
      const sectionItem = button.closest('.section-item');
      sectionItem.remove();
    }
  </script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
      dropdownToggles.forEach(toggle => {
        toggle.addEventListener('click', function() {
          const parent = this.parentElement;
          const dropdownMenu = parent.querySelector('.dropdown-menu');
          document.querySelectorAll('.sidebar-dropdown .dropdown-menu').forEach(menu => {
            if (menu !== dropdownMenu) menu.classList.remove('show');
          });
          dropdownMenu.classList.toggle('show');
          this.classList.toggle('active');
        });
      });
      document.addEventListener('click', function(event) {
        if (!event.target.closest('.sidebar-dropdown')) {
          document.querySelectorAll('.dropdown-menu').forEach(menu => menu.classList.remove('show'));
          document.querySelectorAll('.dropdown-toggle').forEach(toggle => toggle.classList.remove('active'));
        }
      });
    });
  </script>
</body>
</html>